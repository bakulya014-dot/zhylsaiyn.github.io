<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Math/Tech Portfolio - Bakytzhan</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Work+Sans:wght@400;600&display=swap" rel="stylesheet" />
  <script>
    window.MathJax = { tex: { inlineMath: [["$", "$"], ["\\(", "\\)"]] } };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    :root {
      --bg: #0b1220;
      --surface: #111a2e;
      --surface-2: #0e1628;
      --text: #ecf2ff;
      --muted: #98a7c7;
      --accent: #2dd4bf;
      --accent-2: #7cc9ff;
      --warn: #ffcb6b;
      --danger: #ff7a90;
      --line: rgba(255, 255, 255, 0.1);
      --nav: rgba(11, 18, 32, 0.82);
      --shadow: 0 12px 30px rgba(0, 0, 0, 0.28);
    }
    body.light {
      --bg: #f2f6ff;
      --surface: #ffffff;
      --surface-2: #edf3ff;
      --text: #0d1628;
      --muted: #51607d;
      --accent: #0f766e;
      --accent-2: #1d4ed8;
      --warn: #a16207;
      --danger: #be123c;
      --line: rgba(0, 0, 0, 0.1);
      --nav: rgba(242, 246, 255, 0.9);
      --shadow: 0 12px 28px rgba(48, 71, 120, 0.16);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Work Sans", sans-serif;
      background:
        radial-gradient(900px 500px at 12% 8%, rgba(124, 201, 255, 0.14), transparent 60%),
        radial-gradient(1000px 600px at 90% 20%, rgba(45, 212, 191, 0.12), transparent 62%),
        var(--bg);
      color: var(--text);
      transition: background 0.25s ease, color 0.25s ease;
    }
    h1, h2, h3 {
      font-family: "Space Grotesk", sans-serif;
      margin: 0 0 10px;
      letter-spacing: 0.2px;
    }
    .container { max-width: 1120px; margin: 0 auto; padding: 0 24px; }
    .nav {
      position: sticky; top: 0; z-index: 12;
      backdrop-filter: blur(10px);
      background: var(--nav);
      border-bottom: 1px solid var(--line);
    }
    .nav-inner {
      max-width: 1120px; margin: 0 auto; padding: 14px 24px;
      display: flex; align-items: center; justify-content: space-between; gap: 18px;
    }
    .brand { font-family: "Space Grotesk", sans-serif; font-weight: 700; }
    .nav-links { display: flex; align-items: center; gap: 14px; flex-wrap: wrap; justify-content: flex-end; }
    .nav a { color: var(--text); text-decoration: none; font-weight: 600; opacity: 0.88; }
    .nav a:hover, .nav a:focus-visible { color: var(--accent); opacity: 1; }
    .theme-btn {
      border: 1px solid var(--line); color: var(--text); background: transparent;
      border-radius: 10px; padding: 7px 12px; cursor: pointer; font-weight: 600;
    }
    .theme-btn:hover, .theme-btn:focus-visible { border-color: var(--accent); }
    .hero {
      display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 26px;
      align-items: center; padding: 48px 0 24px;
    }
    .pill {
      display: inline-block; border-radius: 999px; border: 1px solid var(--line);
      padding: 6px 12px; color: var(--accent);
      background: color-mix(in srgb, var(--accent) 15%, transparent);
      margin-bottom: 10px; font-size: 0.9rem; font-weight: 600;
    }
    h1 { font-size: clamp(2rem, 4vw, 3rem); }
    .tagline { color: var(--muted); max-width: 65ch; line-height: 1.55; }
    .hero-card, .card, .math-box {
      background: linear-gradient(155deg, var(--surface), var(--surface-2));
      border: 1px solid var(--line); border-radius: 16px; box-shadow: var(--shadow);
      transition: transform 0.22s ease, border-color 0.22s ease;
    }
    .hero-card { padding: 22px; }
    .section { padding: 34px 0; }
    .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
    .card { padding: 16px; }
    .card:hover { transform: translateY(-5px); border-color: color-mix(in srgb, var(--accent) 42%, var(--line)); }
    .link { color: var(--accent-2); text-decoration: none; font-weight: 600; }
    .link:hover, .link:focus-visible { text-decoration: underline; }
    .shot {
      min-height: 120px; border: 1px dashed var(--line); border-radius: 10px;
      display: grid; place-items: center; color: var(--muted); font-size: 0.92rem;
      margin-bottom: 10px;
      background:
        linear-gradient(120deg, color-mix(in srgb, var(--accent-2) 18%, transparent), color-mix(in srgb, var(--accent) 18%, transparent)),
        repeating-linear-gradient(45deg, rgba(255,255,255,0.05), rgba(255,255,255,0.05) 10px, transparent 10px, transparent 20px);
    }
    .math-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; align-items: start; }
    .math-box { padding: 16px; }
    .control-grid {
      display: grid; grid-template-columns: 1fr auto; gap: 6px 8px; align-items: center; margin: 8px 0 10px;
    }
    label { font-size: 0.92rem; color: var(--muted); }
    input[type="number"], input[type="text"] {
      width: 100%; border: 1px solid var(--line); background: var(--surface); color: var(--text);
      border-radius: 8px; padding: 8px;
    }
    input[type="range"] { width: 100%; accent-color: var(--accent); }
    .btn-row { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
    button.action {
      border: 1px solid var(--line); background: color-mix(in srgb, var(--accent) 18%, transparent);
      color: var(--text); border-radius: 9px; cursor: pointer; padding: 8px 12px; font-weight: 600;
    }
    button.action:hover, button.action:focus-visible { border-color: var(--accent); }
    .result {
      margin-top: 8px; border-left: 3px solid var(--accent); padding: 8px 10px;
      background: color-mix(in srgb, var(--surface) 90%, black 10%);
      border-radius: 8px; font-size: 0.95rem; line-height: 1.4;
    }
    .warn { border-left-color: var(--warn); }
    .danger { border-left-color: var(--danger); }
    .small { font-size: 0.88rem; color: var(--muted); }
    canvas {
      width: 100%; max-width: 100%; border: 1px solid var(--line); border-radius: 10px;
      background: color-mix(in srgb, var(--surface) 85%, transparent);
    }
    .calc-grid { display: grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap: 6px; }
    .calc-grid button { padding: 10px 0; }
    .challenge-box {
      border: 1px solid var(--line); border-radius: 12px; padding: 12px;
      background: color-mix(in srgb, var(--surface) 88%, black 12%);
    }
    .contact { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    footer { text-align: center; color: var(--muted); padding: 22px 0 30px; }
    .reveal { opacity: 0; transform: translateY(14px); }
    .reveal.in-view { opacity: 1; transform: translateY(0); transition: opacity 0.45s ease, transform 0.45s ease; }
    @media (max-width: 900px) {
      .hero { grid-template-columns: 1fr; }
      .contact { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="nav-inner">
      <div class="brand">Bakytzhan.dev</div>
      <div class="nav-links">
        <a href="#home">Home</a>
        <a href="#projects">Projects</a>
        <a href="#math">Math Lab</a>
        <a href="#contact">Contact</a>
        <button id="themeToggle" class="theme-btn" type="button">Light Mode</button>
      </div>
    </div>
  </nav>

  <div class="container">
    <section id="home" class="hero reveal">
      <div>
        <span class="pill">Math + Tech Portfolio</span>
        <h1>Hello, I am Bakytzhan</h1>
        <p class="tagline">
          I build interactive math tools, data-driven apps, and creative visualizations.
          My focus is turning complex ideas into intuitive experiences.
        </p>
      </div>
      <div class="hero-card">
        <h3>Quick Profile</h3>
        <p>Student developer, math enthusiast, frontend and Python builder.</p>
        <p>Current focus: visualization, interactive learning, and algorithms.</p>
      </div>
    </section>

    <section id="projects" class="section reveal">
      <h2>Projects</h2>
      <div class="grid-3">
        <article class="card">
          <div class="shot">Live demo: quadratic graph + insights</div>
          <h3>Quadratic Visualizer</h3>
          <p>Solve and graph quadratic equations with real-time parameter updates.</p>
          <a class="link" href="https://github.com/bakulya014-dot" target="_blank" rel="noopener">GitHub</a>
        </article>
        <article class="card">
          <div class="shot">Prime checks and factors</div>
          <h3>Prime Explorer</h3>
          <p>Check primality, factor numbers, and explain divisor logic clearly.</p>
          <a class="link" href="https://github.com/bakulya014-dot" target="_blank" rel="noopener">GitHub</a>
        </article>
        <article class="card">
          <div class="shot">Fibonacci ratio convergence chart</div>
          <h3>Golden Ratio Lab</h3>
          <p>Generate sequences and visualize how ratios approach 1.618...</p>
          <a class="link" href="https://github.com/bakulya014-dot" target="_blank" rel="noopener">GitHub</a>
        </article>
      </div>
    </section>

    <section id="math" class="section reveal">
      <h2>Interactive Math Lab</h2>
      <p class="tagline">Use this section live during your event demo.</p>

      <div class="math-grid">
        <article class="math-box">
          <h3>Quadratic Playground</h3>
          <p class="small">Formula: $$x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$$</p>
          <div class="control-grid">
            <label for="qa">a (must not be 0)</label>
            <input id="qa" type="number" value="1" step="0.1" />
            <input id="qaRange" type="range" min="-5" max="5" step="0.1" value="1" />
            <span class="small">slider</span>
            <label for="qb">b</label>
            <input id="qb" type="number" value="-5" step="0.1" />
            <input id="qbRange" type="range" min="-12" max="12" step="0.1" value="-5" />
            <span class="small">slider</span>
            <label for="qc">c</label>
            <input id="qc" type="number" value="6" step="0.1" />
            <input id="qcRange" type="range" min="-12" max="12" step="0.1" value="6" />
            <span class="small">slider</span>
          </div>
          <div class="btn-row">
            <button class="action" type="button" id="quadSolve">Solve and Draw</button>
            <button class="action" type="button" id="quadExample">Try Example</button>
            <button class="action" type="button" id="quadReset">Reset</button>
          </div>
          <div id="quadResult" class="result"></div>
          <canvas id="quadCanvas" width="420" height="260"></canvas>
        </article>

        <article class="math-box">
          <h3>Fibonacci Studio</h3>
          <div class="control-grid">
            <label for="fibTerms">Number of terms (2-25)</label>
            <input id="fibTerms" type="number" min="2" max="25" value="12" />
          </div>
          <div class="btn-row">
            <button class="action" type="button" id="fibGenerate">Generate</button>
            <button class="action" type="button" id="fibNext">Next Step</button>
            <button class="action" type="button" id="fibPlay">Auto Play</button>
            <button class="action" type="button" id="fibReset">Reset</button>
          </div>
          <div id="fibResult" class="result">Press Generate to start.</div>
          <canvas id="fibChart" width="420" height="200"></canvas>
        </article>

        <article class="math-box">
          <h3>Safe Calculator</h3>
          <label for="calcInput">Expression</label>
          <input id="calcInput" type="text" placeholder="(2+3)*5-4/2" />
          <div class="calc-grid btn-row" style="margin-top:10px;">
            <button class="action" type="button" data-calc="7">7</button>
            <button class="action" type="button" data-calc="8">8</button>
            <button class="action" type="button" data-calc="9">9</button>
            <button class="action" type="button" data-calc="/">/</button>
            <button class="action" type="button" data-calc="4">4</button>
            <button class="action" type="button" data-calc="5">5</button>
            <button class="action" type="button" data-calc="6">6</button>
            <button class="action" type="button" data-calc="*">*</button>
            <button class="action" type="button" data-calc="1">1</button>
            <button class="action" type="button" data-calc="2">2</button>
            <button class="action" type="button" data-calc="3">3</button>
            <button class="action" type="button" data-calc="-">-</button>
            <button class="action" type="button" data-calc="0">0</button>
            <button class="action" type="button" data-calc=".">.</button>
            <button class="action" type="button" data-calc="(">(</button>
            <button class="action" type="button" data-calc=")">)</button>
            <button class="action" type="button" id="calcClear">C</button>
            <button class="action" type="button" id="calcBack">DEL</button>
            <button class="action" type="button" id="calcEquals" style="grid-column: span 2;">=</button>
          </div>
          <div id="calcResult" class="result">Only numbers and + - * / ( ) are allowed.</div>
        </article>

        <article class="math-box">
          <h3>Explain This Result</h3>
          <p class="small">AI-style explanation based on your current quadratic and Fibonacci outputs.</p>
          <div class="btn-row">
            <button class="action" type="button" id="explainNow">Explain</button>
          </div>
          <div id="explainResult" class="result">
            Run a quadratic solve or Fibonacci generation, then click Explain.
          </div>
        </article>
      </div>

      <div class="challenge-box" style="margin-top:16px;">
        <h3>Challenge Mode</h3>
        <p class="small" id="challengePrompt">Press New Challenge to get a random task.</p>
        <div class="btn-row">
          <button class="action" type="button" id="challengeNew">New Challenge</button>
          <input id="challengeAnswer" type="text" placeholder="Your answer" style="max-width:220px;" />
          <button class="action" type="button" id="challengeCheck">Check Answer</button>
        </div>
        <div id="challengeResult" class="result">No challenge yet.</div>
      </div>
    </section>

    <section id="contact" class="section reveal">
      <h2>Contact</h2>
      <div class="contact">
        <article class="card">
          <h3>Email</h3>
          <p><a class="link" href="mailto:bakulya014@gmail.com">bakulya014@gmail.com</a></p>
        </article>
        <article class="card">
          <h3>GitHub</h3>
          <p><a class="link" href="https://github.com/bakulya014-dot" target="_blank" rel="noopener">github.com/bakulya014-dot</a></p>
        </article>
      </div>
    </section>
    <footer>Â© 2026 Bakytzhan - Built for AI event demos with interactive math.</footer>
  </div>

  <script>
    const state = { quadratic: null, fibonacci: null, challenge: null, fibTimer: null };
    const byId = (id) => document.getElementById(id);

    function setupTheme() {
      const toggle = byId("themeToggle");
      const saved = localStorage.getItem("theme");
      if (saved === "light") document.body.classList.add("light");
      toggle.textContent = document.body.classList.contains("light") ? "Dark Mode" : "Light Mode";
      toggle.addEventListener("click", () => {
        document.body.classList.toggle("light");
        const light = document.body.classList.contains("light");
        localStorage.setItem("theme", light ? "light" : "dark");
        toggle.textContent = light ? "Dark Mode" : "Light Mode";
      });
    }

    function setupReveal() {
      const obs = new IntersectionObserver((entries) => {
        entries.forEach((entry) => { if (entry.isIntersecting) entry.target.classList.add("in-view"); });
      }, { threshold: 0.2 });
      document.querySelectorAll(".reveal").forEach((el) => obs.observe(el));
    }

    function pairInputAndRange(inputId, rangeId, onChange) {
      const input = byId(inputId);
      const range = byId(rangeId);
      input.addEventListener("input", () => {
        let v = Number(input.value);
        if (Number.isNaN(v)) return;
        v = Math.max(Number(range.min), Math.min(Number(range.max), v));
        input.value = v;
        range.value = v;
        onChange();
      });
      range.addEventListener("input", () => {
        input.value = range.value;
        onChange();
      });
    }

    function formatNum(n) {
      return Number.isInteger(n) ? String(n) : n.toFixed(4).replace(/0+$/, "").replace(/\.$/, "");
    }

    function drawQuadraticGraph(a, b, c) {
      const canvas = byId("quadCanvas");
      const ctx = canvas.getContext("2d");
      const w = canvas.width, h = canvas.height;
      ctx.clearRect(0, 0, w, h);
      const xMin = -10, xMax = 10, yMin = -10, yMax = 10;
      const toX = (x) => ((x - xMin) / (xMax - xMin)) * w;
      const toY = (y) => h - ((y - yMin) / (yMax - yMin)) * h;

      ctx.strokeStyle = "rgba(180,190,220,0.35)";
      for (let gx = -10; gx <= 10; gx++) { ctx.beginPath(); ctx.moveTo(toX(gx), 0); ctx.lineTo(toX(gx), h); ctx.stroke(); }
      for (let gy = -10; gy <= 10; gy++) { ctx.beginPath(); ctx.moveTo(0, toY(gy)); ctx.lineTo(w, toY(gy)); ctx.stroke(); }

      ctx.strokeStyle = "rgba(255,255,255,0.65)";
      ctx.lineWidth = 1.5;
      ctx.beginPath(); ctx.moveTo(0, toY(0)); ctx.lineTo(w, toY(0)); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(toX(0), 0); ctx.lineTo(toX(0), h); ctx.stroke();

      ctx.strokeStyle = "#2dd4bf";
      ctx.lineWidth = 2.5;
      ctx.beginPath();
      for (let px = 0; px <= w; px++) {
        const x = xMin + (px / w) * (xMax - xMin);
        const y = a * x * x + b * x + c;
        const py = toY(y);
        if (px === 0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
      }
      ctx.stroke();
    }

    function solveQuadratic() {
      const a = Number(byId("qa").value), b = Number(byId("qb").value), c = Number(byId("qc").value);
      const result = byId("quadResult");
      if ([a, b, c].some(Number.isNaN)) {
        result.className = "result danger"; result.textContent = "Please enter valid numbers."; return;
      }
      if (a === 0) {
        result.className = "result danger"; result.textContent = "a cannot be 0 for a quadratic equation.";
        drawQuadraticGraph(a, b, c); return;
      }
      const d = b*b - 4*a*c;
      const vx = -b / (2*a), vy = a*vx*vx + b*vx + c;
      let roots = "";
      if (d > 0) {
        const r1 = (-b + Math.sqrt(d)) / (2*a), r2 = (-b - Math.sqrt(d)) / (2*a);
        roots = `Two real roots: x1=${formatNum(r1)}, x2=${formatNum(r2)}.`;
      } else if (d === 0) {
        roots = `One repeated root: x=${formatNum(-b/(2*a))}.`;
      } else {
        roots = "No real roots (complex roots).";
      }
      result.className = "result";
      result.textContent = `Discriminant: ${formatNum(d)}. ${roots} Vertex: (${formatNum(vx)}, ${formatNum(vy)}).`;
      state.quadratic = { a, b, c, d, vx, vy };
      drawQuadraticGraph(a, b, c);
    }

    function quadraticExample() {
      byId("qa").value = 1; byId("qb").value = -3; byId("qc").value = 2;
      byId("qaRange").value = 1; byId("qbRange").value = -3; byId("qcRange").value = 2;
      solveQuadratic();
    }

    function quadraticReset() {
      byId("qa").value = 1; byId("qb").value = -5; byId("qc").value = 6;
      byId("qaRange").value = 1; byId("qbRange").value = -5; byId("qcRange").value = 6;
      byId("quadResult").className = "result";
      byId("quadResult").textContent = "Ready. Edit coefficients or use Try Example.";
      solveQuadratic();
    }

    function makeFibList(n) {
      const out = [0, 1];
      while (out.length < n) out.push(out[out.length - 1] + out[out.length - 2]);
      return out.slice(0, n);
    }

    function fibRatios(seq) {
      const ratios = [];
      for (let i = 2; i < seq.length; i++) if (seq[i - 1] !== 0) ratios.push(seq[i] / seq[i - 1]);
      return ratios;
    }

    function drawFibChart(ratios) {
      const canvas = byId("fibChart"), ctx = canvas.getContext("2d");
      const w = canvas.width, h = canvas.height;
      ctx.clearRect(0, 0, w, h);
      ctx.strokeStyle = "rgba(180,190,220,0.32)";
      for (let i = 0; i <= 5; i++) { ctx.beginPath(); ctx.moveTo(0, (i/5)*h); ctx.lineTo(w, (i/5)*h); ctx.stroke(); }

      const phi = (1 + Math.sqrt(5)) / 2;
      const yMin = 1, yMax = Math.max(2, ...ratios, phi);
      const toY = (v) => h - ((v - yMin) / (yMax - yMin)) * h;

      ctx.strokeStyle = "#ffcb6b";
      ctx.beginPath(); ctx.moveTo(0, toY(phi)); ctx.lineTo(w, toY(phi)); ctx.stroke();

      if (!ratios.length) return;
      ctx.strokeStyle = "#7cc9ff"; ctx.lineWidth = 2; ctx.beginPath();
      ratios.forEach((r, i) => {
        const x = (i / Math.max(1, ratios.length - 1)) * w;
        const y = toY(r);
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      });
      ctx.stroke();
    }

    function renderFibProgress(limit) {
      const seq = state.fibonacci.full.slice(0, limit);
      const ratios = fibRatios(seq);
      const ratioText = ratios.length ? ratios[ratios.length - 1].toFixed(6) : "n/a";
      byId("fibResult").className = "result";
      byId("fibResult").textContent = `Sequence (${seq.length} terms): ${seq.join(", ")}. Latest ratio Fn/Fn-1: ${ratioText}`;
      drawFibChart(ratios);
      state.fibonacci.lastShown = limit;
    }

    function fibGenerate() {
      const n = Number(byId("fibTerms").value), out = byId("fibResult");
      if (Number.isNaN(n) || n < 2 || n > 25) {
        out.className = "result danger"; out.textContent = "Enter a valid number between 2 and 25."; return;
      }
      state.fibonacci = { full: makeFibList(n), lastShown: 0 };
      renderFibProgress(2);
    }

    function fibNextStep() {
      if (!state.fibonacci) { fibGenerate(); return; }
      renderFibProgress(Math.min(state.fibonacci.full.length, state.fibonacci.lastShown + 1));
    }

    function fibAutoPlay() {
      const btn = byId("fibPlay");
      if (state.fibTimer) {
        clearInterval(state.fibTimer); state.fibTimer = null; btn.textContent = "Auto Play"; return;
      }
      if (!state.fibonacci) fibGenerate();
      btn.textContent = "Stop";
      state.fibTimer = setInterval(() => {
        const next = state.fibonacci.lastShown + 1;
        if (next > state.fibonacci.full.length) {
          clearInterval(state.fibTimer); state.fibTimer = null; btn.textContent = "Auto Play"; return;
        }
        renderFibProgress(next);
      }, 550);
    }

    function fibReset() {
      byId("fibTerms").value = 12;
      if (state.fibTimer) { clearInterval(state.fibTimer); state.fibTimer = null; }
      byId("fibPlay").textContent = "Auto Play";
      state.fibonacci = null;
      byId("fibResult").className = "result";
      byId("fibResult").textContent = "Press Generate to start.";
      drawFibChart([]);
    }

    function tokenize(expression) {
      const clean = expression.replace(/\s+/g, "");
      if (!/^[0-9+\-*/().]*$/.test(clean)) throw new Error("Only numbers and + - * / ( ) are allowed.");
      const tokens = [];
      let i = 0;
      while (i < clean.length) {
        const c = clean[i];
        if ("+-*/()".includes(c)) {
          if (c === "-" && (i === 0 || "+-*/(".includes(clean[i - 1]))) {
            let j = i + 1; while (j < clean.length && /[0-9.]/.test(clean[j])) j++;
            const num = clean.slice(i, j);
            if (!/^-[0-9]*\.?[0-9]+$/.test(num)) throw new Error("Invalid negative number.");
            tokens.push(num); i = j; continue;
          }
          tokens.push(c); i++; continue;
        }
        if (/[0-9.]/.test(c)) {
          let j = i + 1; while (j < clean.length && /[0-9.]/.test(clean[j])) j++;
          const num = clean.slice(i, j);
          if (!/^[0-9]*\.?[0-9]+$/.test(num)) throw new Error("Invalid number.");
          tokens.push(num); i = j; continue;
        }
        throw new Error("Invalid character.");
      }
      return tokens;
    }

    function toRpn(tokens) {
      const out = [], stack = [], prec = { "+":1, "-":1, "*":2, "/":2 };
      tokens.forEach((t) => {
        if (!Number.isNaN(Number(t))) out.push(t);
        else if ("+-*/".includes(t)) {
          while (stack.length && "+-*/".includes(stack[stack.length - 1]) && prec[stack[stack.length - 1]] >= prec[t]) out.push(stack.pop());
          stack.push(t);
        } else if (t === "(") stack.push(t);
        else if (t === ")") {
          while (stack.length && stack[stack.length - 1] !== "(") out.push(stack.pop());
          if (!stack.length) throw new Error("Mismatched parentheses.");
          stack.pop();
        }
      });
      while (stack.length) {
        const top = stack.pop();
        if (top === "(" || top === ")") throw new Error("Mismatched parentheses.");
        out.push(top);
      }
      return out;
    }

    function evalRpn(tokens) {
      const s = [];
      tokens.forEach((t) => {
        if (!Number.isNaN(Number(t))) s.push(Number(t));
        else {
          if (s.length < 2) throw new Error("Invalid expression.");
          const b = s.pop(), a = s.pop();
          if (t === "+") s.push(a + b);
          if (t === "-") s.push(a - b);
          if (t === "*") s.push(a * b);
          if (t === "/") {
            if (b === 0) throw new Error("Division by zero.");
            s.push(a / b);
          }
        }
      });
      if (s.length !== 1) throw new Error("Invalid expression.");
      return s[0];
    }

    function calcEvaluate() {
      const input = byId("calcInput"), out = byId("calcResult");
      try {
        const expr = input.value.trim();
        if (!expr) throw new Error("Type an expression first.");
        const value = evalRpn(toRpn(tokenize(expr)));
        out.className = "result"; out.textContent = `Result: ${formatNum(value)}`;
      } catch (e) {
        out.className = "result danger"; out.textContent = String(e.message || e);
      }
    }

    function explainResults() {
      const out = byId("explainResult");
      const lines = [];
      if (state.quadratic) {
        const shape = state.quadratic.a > 0 ? "opens upward" : "opens downward";
        const rootType = state.quadratic.d > 0 ? "two real roots" : state.quadratic.d === 0 ? "one repeated root" : "complex roots";
        lines.push(`Quadratic: parabola ${shape}, with ${rootType}. Vertex at (${formatNum(state.quadratic.vx)}, ${formatNum(state.quadratic.vy)}).`);
      }
      if (state.fibonacci && state.fibonacci.lastShown >= 3) {
        const seq = state.fibonacci.full.slice(0, state.fibonacci.lastShown);
        const ratios = fibRatios(seq);
        lines.push(`Fibonacci: Fn/Fn-1 is approaching 1.618. Current estimate: ${ratios[ratios.length - 1].toFixed(6)}.`);
      }
      if (!lines.length) lines.push("Run Quadratic Solve or Fibonacci Generate first.");
      out.className = "result"; out.textContent = lines.join(" ");
    }

    function newChallenge() {
      const type = Math.random() < 0.5 ? "quadratic" : "fibonacci";
      if (type === "quadratic") {
        const target = ["positive", "zero", "negative"][Math.floor(Math.random() * 3)];
        const presets = {
          positive: { a: 1, b: -3, c: 2 },
          zero: { a: 1, b: -2, c: 1 },
          negative: { a: 2, b: 1, c: 3 }
        };
        const p = presets[target];
        state.challenge = { answer: target };
        byId("challengePrompt").textContent = `Challenge: For a=${p.a}, b=${p.b}, c=${p.c}, is discriminant positive, zero, or negative?`;
      } else {
        const seeds = [
          { seq: [0,1,1,2,3], answer: "5" },
          { seq: [1,1,2,3,5], answer: "8" },
          { seq: [2,3,5,8,13], answer: "21" }
        ];
        const pick = seeds[Math.floor(Math.random() * seeds.length)];
        state.challenge = { answer: pick.answer };
        byId("challengePrompt").textContent = `Challenge: Next number in sequence ${pick.seq.join(", ")} ?`;
      }
      byId("challengeAnswer").value = "";
      byId("challengeResult").className = "result";
      byId("challengeResult").textContent = "Waiting for your answer.";
    }

    function checkChallenge() {
      const out = byId("challengeResult");
      const ans = byId("challengeAnswer").value.trim().toLowerCase();
      if (!state.challenge) { out.className = "result warn"; out.textContent = "Create a challenge first."; return; }
      if (!ans) { out.className = "result warn"; out.textContent = "Type an answer first."; return; }
      if (ans === state.challenge.answer) { out.className = "result"; out.textContent = "Correct. Great presentation moment."; }
      else { out.className = "result danger"; out.textContent = `Not yet. Correct answer: ${state.challenge.answer}.`; }
    }

    function init() {
      setupTheme();
      setupReveal();

      pairInputAndRange("qa", "qaRange", solveQuadratic);
      pairInputAndRange("qb", "qbRange", solveQuadratic);
      pairInputAndRange("qc", "qcRange", solveQuadratic);

      byId("quadSolve").addEventListener("click", solveQuadratic);
      byId("quadExample").addEventListener("click", quadraticExample);
      byId("quadReset").addEventListener("click", quadraticReset);

      byId("fibGenerate").addEventListener("click", fibGenerate);
      byId("fibNext").addEventListener("click", fibNextStep);
      byId("fibPlay").addEventListener("click", fibAutoPlay);
      byId("fibReset").addEventListener("click", fibReset);

      document.querySelectorAll("[data-calc]").forEach((btn) => {
        btn.addEventListener("click", () => { byId("calcInput").value += btn.dataset.calc; byId("calcInput").focus(); });
      });
      byId("calcClear").addEventListener("click", () => byId("calcInput").value = "");
      byId("calcBack").addEventListener("click", () => {
        const i = byId("calcInput");
        i.value = i.value.slice(0, -1);
        i.focus();
      });
      byId("calcEquals").addEventListener("click", calcEvaluate);

      byId("explainNow").addEventListener("click", explainResults);
      byId("challengeNew").addEventListener("click", newChallenge);
      byId("challengeCheck").addEventListener("click", checkChallenge);

      ["qa","qb","qc","fibTerms","calcInput","challengeAnswer"].forEach((id) => {
        byId(id).addEventListener("keydown", (e) => {
          if (e.key !== "Enter") return;
          if (id === "fibTerms") fibGenerate();
          else if (id === "calcInput") calcEvaluate();
          else if (id === "challengeAnswer") checkChallenge();
          else solveQuadratic();
        });
      });

      quadraticReset();
      fibReset();
      drawFibChart([]);
    }

    init();
  </script>
</body>
</html>




